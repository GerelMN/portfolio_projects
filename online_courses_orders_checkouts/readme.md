

[Назад](https://gerelmn.github.io/portfolio_projects/)

# Анализ платежей образовательной платформы
## Краткое описание и содержание проекта:
1. [A/B - тестирование](https://gerelmn.github.io/portfolio_projects/online_courses_orders_checkouts/#1-ab-тестирование-см-подробнее)
2. [SQL](https://gerelmn.github.io/portfolio_projects/online_courses_orders_checkouts/#2-sql-см-подробнее)
4. [Python](https://gerelmn.github.io/portfolio_projects/online_courses_orders_checkouts/#3-python-см-подробнее)

## 1. A/B-тестирование ([см. подробнее](https://github.com/GerelMN/portfolio_projects/blob/main/online_courses_orders_checkouts/AB_testing_online_courses.ipynb))

В ходе тестирования одной гипотезы целевой группе была предложена новая механика оплаты услуг на сайте, у контрольной группы оставалась базовая механика. 
<br>**Цель:** проанализировать итоги эксперимента и сделать вывод, стоит ли запускать новую механику оплаты на всех пользователей.

**Входные данные:** файл csv с информацией о принадлежности пользователя к контрольной или экспериментальной группе (А – контроль, B – целевая группа), дополнительный файл с пользователями, который прислали спустя 2 дня после передачи данных, файл с информацией о пользователях, которые зашли на платформу в дни проведения эксперимента, файл с информацией об оплатах пользователей в дни проведения эксперимента.

**Предварительное исследование** : пропущенных значений и дубликатов нет, соотношение контрольной и тестовой групп в общей выборке 20/80, каждого пользователя можно отфильтровать по признакам активности и оплаты. Группы приблизительно одинаковые по составу трафика. В обеих группах есть неактивные пользователи совершившие покупку. Поскольку в данных нет информации о датах событий, в проекте было принято считать таких пользователей, начавшими процесс покупки до начала экперимента и не проявившими активности во время эксперимента. 

**Выбор метрик и анализ.** Для оценки влияния новой механики оплаты на бизнес проведен анализ **_Конверсии_** и **_Среднего чека_**, произведение которых дает относительную выручку (Revenue per visitor = Conversion rate * Average Order Value)
<br>Для анализа учитывались только активные пользователи, т.е. те которые заходили на платформу в период проведения экперимента, т.к. на тех пользователей, которые в это время не заходили на платформу, эксперимент не мог повлиять.
<br>Для тестирования гипотезы о равенстве **_конверсий_** двух групп использовался **_Z-тест_** пропорций. Результаты теста не позволили отклонить нулевую гипотезу о том, что конверсии двух групп одинаковы. Вероятность получить разницу в конверсиях 8% при том, что нулевая гипотеза верна составляет 44%. При этом анализ мощности показал очень низкую мощность теста гипотезы 13%, следовательно веротяность совершить ошибку II рода - 87%. Далее был расчитан необходимый размер выборки для достижения мощности теста в 80%. 
<br>В ходе анализа **_средних чеков_** были рассмотрены распределения сумм чеков. В целом в обеих группах присутствует зависимость: чем выше стоимость чека, тем меньше количество чеков. Однако в тестовой группе присутствует аномально большое количество чеков на 1900.   
![alt-текст](https://raw.githubusercontent.com/GerelMN/portfolio_projects/main/online_courses_orders_checkouts/dataset/2023-03-13_12-39-42.png)
<br>Возможно на 128 пользоваелей с чеком 1900 мог оказывать действие неизвестный нам фактор. Пользователи могли попасть под влияние другого теста, проводимого в компании. Кроме того аномальный скачок мог стать результатом того, что тема продаваемого курса стала мегапопулярной среди пользователей, в связи с новым модным трендом или сезоном. Для точного определения природы этой аномалии мы не располагаем данными. Среди пользователей, которые начали процесс покупки до начала эксперимента такого выброса по чеку 1900 нет, в контрольной группе такой чек отсутствует вовсе. Для последующего анализа 128 пользователей были удалены и было проведено два сравнения средних чеков: контрольной и тестовой групп, контрольной и откорректированой на 128 пользователей тестовой групп.  
Для тестирования гипотезы о равенстве **_средних чеков_** двух групп был использован **_T критерий Уэлша_**. Тест показал следующие результаты: 1. для тестовой и контрольной групп -  вероятность получить различие на 34,73% при том, что нулевая гипотеза верна составляет менее 5% - разница статистически значима; 2. для тестовой и откорректированная групп - вероятность получить различие на 12,59% при том, что нулевая гипотеза верна, довольно большая- 32%. Можно прийти к выводу, что именно скачок количества чеков на 1900 оказывает влияние на значимость результата теста, но посокльку нам неизвестна причина этого выброса, реузльат теста сомнителен относительно предмета тестирования - новой механики оплаты. Логично предположить, что новая механика оплаты должна повлиять на все виды чеков в равной степени, а не на один отдельный. Скорее всего на разницу чеков повлиял другой неизвестный нам фактор(другой тест, сезон, мода).  
Далее была расчитана мощность теста, не давшего оснований отклонить нулевую гипотезу, и вероятность совершить ошибку II рода. Статистическая мощность теста контрольной и откорректированной тестовой группы 31%, вероятность совершить ошибку второго рода 69%. Был расчитан необходимый размер выборок для достижения 80% мощности теста.  

**Вывод.** Целью исследования было определить влияет ли новая механика оплаты на выручку компании. Для этого было проведено сравнение между контрольной и тестовой группой по двум метрикам - конверсия и средний чек и были сделаны следующие наблюдения:
* Сравнение конверсий двух групп показало, что оснований утверждать, что разница стат.значима нет. 

* В данных об оплате был обнаружен аномальный рост количества чеков на сумму 1900. Возможно на наблюдения, выбранные для экперимента по влиянию новой механики оплаты, оказывал действие другой эксперимент, проводимый в компании. Произошло пересечение между наблюдениями двух экпериментов.
* Без учета аномальных данных сравнение среднего чека по двум группам не дало стат.значимого результата
* На основании полученных данных мы не можем утверждать, что существует разница между двумя группами, однако, по обеим метрикам, недостаточное количество полученных данных не дает нам утверждать, что разницы действительно нет. 

Для получения более точных результатов, при дизайне экперимента нужно было учесть, что для использования несбалансированного теста требуется иметь достаточный объем трафика для обнаружения интересующих изменений в метрике и чем больше это изменение(например 20% и выше), тем больше вероятность его обнаружить. 
В нашем случае зафиксированные изменения очень маленькие, при балансе 20/80 не хватает трафика для достижения мощности теста 80%. Если ожидаемый прирост или падение метрики достаточно маленькие (допустим, меньше 5%), то для достижения необходимой мощности теста можно придерживаться баланса 50/50. 

**_Следует ли запускать новую механику оплаты на всех пользователей?_**
<br>На данном этапе - нет. У нас нет уверенности в достоверности полученных данных, требуется больше наблюдений для эксперимента. Результат запуска новой механики оплаты на всех пользователей на данном этапе непредсказуем. Мы можем получить как положительный так и отрицательный эффект, либо получить очень незначительный эффект, который не превысит стоимости затраченных ресурсов на внедрение новой механики оплаты на всех пользователей.  

# 2. SQL ([см. подробнее](https://github.com/GerelMN/portfolio_projects/blob/main/online_courses_orders_checkouts/SQL_online_courses.ipynb))
**2.1. Условие:**  
Образовательные курсы состоят из различных уроков, каждый из которых состоит из нескольких маленьких заданий. Каждое такое маленькое задание называется "горошиной". <br>Назовём очень усердным учеником того пользователя, который хотя бы раз за текущий месяц правильно решил 20 горошин.
<br>Дана таблица в Clickhouse **default.peas**:

|Название атрибута|Тип атрибута|Смысловое значение|
|:-|:-|:-|
|st_id|int|ID ученика|
|timest|timestamp|Время решения карточки|
|correct|bool|Правильно ли решена горошина?|
|subject|text|Дисциплина, в которой находится горошина|

**Задача: Необходимо написать оптимальный запрос, который даст информацию о количестве очень усердных студентов.**
<br>NB! Под очень усердным студентом мы понимаем студента, который правильно решил 20 задач за текущий месяц.

**2.2. Условие:**  
Образовательная платформа предлагает пройти студентам курсы по модели trial: студент может решить бесплатно лишь 30 горошин в день. Для неограниченного количества заданий в определенной дисциплине студенту необходимо приобрести полный доступ. Команда провела эксперимент, где был протестирован новый экран оплаты.
<br>Дана таблицы в Clickhouse: **default.peas (см. выше), default.studs:**

|Название атрибута|Тип атрибута|Смысловое значение|
|:-|:-|:-|
|st_id|int|ID ученика|
|test_grp|text|Метка ученика в данном эксперименте|

и **default.final_project_check:**

|Название атрибута|Тип атрибута|Смысловое значение|
|:-|:-|:-|
|st_id|int|ID ученика|
|sale_time|timestamp|Время покупки|
|money|int|Цена, по которой приобрели данный курс|
|subject|text|Дисциплина, на которую приобрели полный доступ|

**Задача: Необходимо в одном запросе выгрузить следующую информацию о группах пользователей:**
* ARPU 
* ARPAU 
* CR в покупку 
* СR активного пользователя в покупку 
* CR пользователя из активности по математике (subject = ’math’) в покупку курса по математике
* ARPU считается относительно всех пользователей, попавших в группы.  

Активным считается пользователь, за все время решивший больше 10 задач правильно в любых дисциплинах.
<br>Активным по математике считается пользователь, за все время решивший 2 или больше задач правильно по математике.

# 3. Python ([см. подробнее](https://github.com/GerelMN/portfolio_projects/blob/main/online_courses_orders_checkouts/python_online_courses.ipynb))
Реализована функция, которая автоматически подгружает информацию из дополнительного файла и на основании дополнительных параметров пересчитывать метрики (AOV, CR, RPV). Так же реализована функция, которая строит графики по получаемым метрикам. 
